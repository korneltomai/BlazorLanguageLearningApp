@page "/sets"
@page "/sets/{folderId:int}"

@using BlazorLanguageLearningApp.Shared

@inject FolderService FolderService
@inject NavigationManager Navigation
@inject IStringLocalizer<Sets> Localization

@if (FolderId != default && CurrentFolder == null)
{
    <NotFoundPage />
}
else
{
    <PageTitle>Sets</PageTitle>

    <div class="row d-lg-flex m-0 p-0">
        <div class="bg-light d-none d-lg-block col-lg-3 col-xxl-2">
            <div>
                <h3 class="text-center mt-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
                        <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139q.323-.119.684-.12h5.396z" />
                    </svg>
                    @Localization["Folders"]
                </h3>
                <div class="sidebar overflow-auto pb-1">
                    @foreach (Folder folder in FolderService.GetAllFolders())
                    {
                        <div class="container justify-content-center">
                            <a class="btn btn-primary w-100 mb-1" href="/sets/@folder.Id">@folder.Name</a>
                        </div>
                    }
                </div>
            </div>
            <div class="mt-2">
                <button class="btn btn-success w-100 my-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-square me-1" viewBox="0 0 16 16">
                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                    </svg>
                    @Localization["CreateNewFolder"]
                </button>
            </div>
        </div>

        <div class="content d-flex flex-column col-lg-9 col-xxl-10">
            @if (FolderId == default)
            {
                <div class="container-fluid">
                    <div class="mt-lg-2">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="sets">@Localization["Sets"]</a></li>
                            </ol>
                        </nav>
                    </div>
                    <p>No folder open</p>
                </div>
            }
            else
            {
                <div class="container-fluid">
                    <div class="mt-lg-2">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mb-2">
                                <li class="breadcrumb-item"><a href="sets">@Localization["Sets"]</a></li>
                                <li class="breadcrumb-item active" aria-current="page">@CurrentFolder!.Name</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-9 col-xxl-10">
                            <div class="d-flex align-items-center">
                                <span class="h2 mb-0">@CurrentFolder.Name</span>
                                <span class="text-secondary ms-2 me-auto"><small>@CurrentFolder.Visibility</small></span>
                            </div>
                            <div class="mb-3 mb-sm-0 me-sm-4 pe-2">
                                @CurrentFolder.Description
                            </div>
                        </div>
                        <div class="d-flex align-items-center col-12 col-sm-3 col-xxl-2 ps-sm-0">
                            <div class="d-flex d-sm-block w-100 p-0 m-0">
                                <div class="col-6 col-sm-12 p-0">
                                    <button class="btn btn-primary d-block w-100 me-2 me-sm-0" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z" />
                                        </svg>
                                        @Localization["Edit"]
                                    </button>
                                </div>
                                <div class="col-6 col-sm-12 mt-sm-1 p-0">
                                    <button class="btn btn-danger d-block w-100 ms-2 ms-sm-0" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                            <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                                        </svg>
                                        @Localization["Delete"]
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="container-fluid mb-3">
                    <div class="d-flex align-items-center flex-wrap">
                        <div class="col-12 col-sm-auto me-auto mb-2 mb-sm-0">
                            <button class="btn btn-success d-block w-100" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-square me-1" viewBox="0 0 16 16">
                                    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                </svg>
                                @Localization["CreateNewSet"]
                            </button>
                        </div>
                        <div class="form-floating col-12 col-sm-auto ms-auto p-0">
                            <select class="form-select bg-primary text-white" id="orderBySelect" aria-label="Order sets by">
                                <option selected value="nameIncreasing">@Localization["NameAZ"]</option>
                                <option value="nameDecreasing">@Localization["NameZA"]</option>
                                <option value="scoreIncreasing">@Localization["ScoreIncreasing"]</option>
                                <option value="scoreDecreasing">@Localization["ScoreDecreasing"]</option>
                            </select>
                            <label class="text-white" for="orderBySelect"><small>@Localization["OrderBy"]</small></label>
                        </div>
                    </div>
                    <div class="d-flex flex-row-reverse w-100">
                        <span class="h5 mt-2 mb-0">@String.Format($"{Localization["SetsInFolder"]}", @CurrentFolder.Sets.Count())</span>
                    </div>
                </div>
                <div class="container-fluid">
                    <div class="d-flex flex-column pb-3">
                        @foreach (BlazorLanguageLearningApp.Shared.Set set in CurrentFolder.Sets)
                        {
                            <a class="setLink me-2 mt-2" href="/sets/@FolderId/@set.Id">
                                <div class="d-flex row border border-black rounded-3 mx-0">
                                    <div class="col-10 col-md-11 my-3 pe-0">
                                        <div class="d-flex justify-content-center px-1">
                                            <span class="h4 mb-0">@set.Name</span>
                                        </div>
                                        <div class="d-flex justify-content-center">
                                            <small class="text-secondary">@set.TermsLanguage - @set.DefinitionsLanguage</small>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-row-reverse col-2 col-md-1 p-0">
                                        <div class="learntPercantage d-flex justify-content-center align-items-center bg-primary rounded-circle border border-primary m-2">
                                            @set.LearntPercantage
                                        </div>
                                    </div>
                                </div>
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public int FolderId { get; set; }

    private Folder? CurrentFolder { get; set; }

    protected override void OnInitialized()
    {
        FolderService.OnChange.Add(StateHasChanged);
    }

    protected override void OnParametersSet()
    {
        if (FolderId != default)
        {
            CurrentFolder = FolderService.GetFolder(FolderId);
        }
    }
}
