@page "/sets"
@page "/sets/{folderId:int}"

@using BlazorLanguageLearningApp.Shared

@inject FolderService FolderService
@inject NavigationManager Navigation

@if (FolderId != default && CurrentFolder == null)
{
    <NotFoundPage />
}
else
{
    <PageTitle>Sets</PageTitle>

    <div class="row d-lg-flex m-0 p-0">
        <div class="bg-light d-none d-lg-block col-lg-3 col-xxl-2">
            <div>
                <h3 class="text-center mt-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
                        <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139q.323-.119.684-.12h5.396z" />
                    </svg>
                    Folders
                </h3>
                <div class="sidebar overflow-auto pb-1">
                    @foreach (Folder folder in FolderService.GetAllFolders())
                    {
                        <div class="container justify-content-center">
                            <a class="btn btn-primary w-100 mb-1" href="/sets/@folder.Id">@folder.Name</a>
                        </div>
                    }
                </div>
            </div>
            <div>
                <button class="btn btn-primary w-100 my-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                    </svg>
                    Create new folder
                </button>
            </div>
        </div>

        <div class="folderContent d-flex flex-column col-lg-9 col-xxl-10">
            @if (FolderId == default)
            {
                <div class="container-fluid">
                    <p>No folder open</p>
                </div>
            }
            else
            {
                <div class="container-fluid">
                    <div class="mt-lg-2">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="sets">Sets</a></li>
                                <li class="breadcrumb-item active" aria-current="page">@CurrentFolder.Name</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="d-flex flex-wrap flex-sm-nowrap">
                        <div class="col-12 col-sm-9 col-md-10 col-lg-9 col-xl-10">
                            <div class="d-flex align-items-center">
                                <span class="h2">@CurrentFolder.Name</span>
                                <span class="ms-2"><small>@CurrentFolder.Visibility</small></span>
                            </div>
                            <div class="mb-3 mb-sm-0 me-sm-5">
                                @CurrentFolder.Description
                            </div>
                        </div>
                        <div class="align-items-center col-12 col-sm-3 col-md-2 col-lg-3 col-xl-2">
                            <div class="d-flex align-items-center h-100">
                                <div class="w-100">
                                    <div class="d-flex justify-content-center">
                                        <button class="btn btn-primary d-block w-100" type="button">Edit</button>
                                    </div>
                                    <div class="d-flex justify-content-center mt-1">
                                        <button class="btn btn-danger d-block w-100" type="button">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="container-fluid mb-3">
                    <div class="d-flex align-items-center flex-wrap">
                        <div class="me-auto col-12 col-sm-auto mb-2 mb-sm-0">
                            <button class="btn btn-primary d-block w-100" type="button">Create new set</button>
                        </div>
                        <div class="me-auto me-sm-3">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="showPerfectCheck">
                                <label class="form-check-label" for="showPerfectCheck">Show perfect sets</label>
                            </div>
                        </div>
                        <div>
                            <div class="form-floating">
                                <select class="form-select bg-primary text-light" id="orderBySelect" aria-label="Order sets by">
                                    <option selected value="nameIncreasing">Name (a-z)</option>
                                    <option value="nameDecreasing">Name (z-a)</option>
                                </select>
                                <label class="text-light" for="orderBySelect"><small>Order by</small></label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid overflow-auto">
                    <div class="d-flex flex-column">
                        @foreach (Set set in CurrentFolder.Sets)
                        {
                            <a class="setLink me-2 mt-2" href="/sets/@FolderId/@set.Id">
                                <div class="d-flex border border-black rounded-3 row">
                                    <div class="col-10 col-md-11 my-3 pe-0">
                                        <div class="d-flex justify-content-center px-1">
                                            <span class="h3 mb-0 text-center">@set.Name</span>
                                        </div>
                                        <div class="d-flex justify-content-center">
                                            <small class="text-secondary">@set.TermsLanguage - @set.DefinitionsLanguage</small>
                                        </div>
                                    </div>
                                    <div class="col-2 col-md-1 p-0">
                                        <div class="learntPercantageContainer d-flex flex-row-reverse">
                                            <div class="learntPercantage d-flex justify-content-center align-items-center rounded-circle border border-primary bg-primary m-2">
                                                @set.LearntPercantage
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public int FolderId { get; set; }

    private Folder? CurrentFolder { get; set; }

    protected override void OnInitialized()
    {
        FolderService.OnChange.Add(StateHasChanged);
    }

    protected override void OnParametersSet()
    {
        if (FolderId != default)
        {
            CurrentFolder = FolderService.GetFolder(FolderId);
        }
    }
}
