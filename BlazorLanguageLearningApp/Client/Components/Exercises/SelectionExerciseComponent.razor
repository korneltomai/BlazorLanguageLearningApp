@inject IStringLocalizer<Pages.Exercises> Loc

<div class="border border-2 rounded-3 my-5 @exerciseValidationStyle">
    <div class="pt-3 px-3">
        <span class="h5">@Loc["SelectionExerciseHeader"]</span>
    </div>
    <hr/>
    <div class="text-center">
        <div class="fs-3">@Exercise.Question.Expression</div>
        <div class="small">@Exercise.Question.Language</div>
    </div>
    <div class="w-100 p-3 pt-2">
        @foreach (var answer in Exercise.PossibleAnswers)
        {
            <div class="mt-2">
                <input type="radio" class="btn-check" name="@String.Format("answer{0}", ExerciseNumber)" id="@String.Format("answer{0}{1}", ExerciseNumber, answer.Expression)" @onchange="@(() => UpdateAnswer(answer))" checked="@(Exercise.UserAnswer == answer)" autocomplete="off">
                <label class="btn btn-outline-primary w-100" for="@String.Format("answer{0}{1}", ExerciseNumber, answer.Expression)">
                    <span class="d-block"><strong>@answer.Expression</strong></span>
                    <span class="small d-block">@answer.Language</span>
                </label>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public required int ExerciseNumber { get; set; }

    [Parameter]
    public required Exercise Exercise { get; set; }

    [Parameter]
    public required EventCallback<(ExerciseEntry, int)> OnUserAnswered { get; set; }

    [Parameter]
    public required Action<Action> OnExerciseSheetSolved { get; set; }

    private string exerciseValidationStyle = "";

    protected override void OnInitialized()
    {
        OnExerciseSheetSolved(UpdateStateToSolved);
    }

    private void UpdateAnswer(ExerciseEntry answer)
    {
        Exercise.UserAnswer = answer;
        OnUserAnswered.InvokeAsync((answer, ExerciseNumber));
    }

    private void UpdateStateToSolved()
    {
        exerciseValidationStyle = "border-success";
    }
}
